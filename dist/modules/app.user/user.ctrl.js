!function(e){"use strict";e.module("app.user").controller("UserCtrl",["UserService","$state","$stateParams","$scope","$mdDialog","$mdSidenav","$location",function(e,n,o,i,r,s,t){var a=this;a.sidenav={sections:[{name:"Account Settings",type:"heading",children:[{name:"Profile",url:"modules/app.user/views/account.profile.html",type:"link"},{name:"Security",url:"modules/app.user/views/account.security.html",type:"link"}]}],selectedSection:void 0},a.firstLoad=!0,a.signingUp=!1,a.loggingIn=!1,a.updatingProifle=!1,a.changingEmail=!1,a.removingAcccount=!1,a.changingPassword=!1,a.resettingPassword=!1,a.signupData={},a.loginData={rememberMe:!0},a.passwordResetData={},a.loginError=void 0,a.signupError=void 0,a.profileError=void 0,a.emailError=void 0,a.removeAccountError=void 0,a.passwordChangeError=void 0,a.passwordResetError=void 0,a.profileMsg=void 0,a.emailMsg=void 0,a.passwordChangeMsg=void 0,a.passwordResetMsg=void 0,a.userEdit={},a.userDelete={},a.passwordChange={},a.user=void 0,a.init=function(){var e=t.search().section;e>=0&&e<a.sidenav.sections[0].children.length?a.onSectionSelected(a.sidenav.sections[0].children[e]):a.onSectionSelected(a.sidenav.sections[0].children[0]),a.firstLoad=!1},a.saveProfile=function(){a.updatingProfile=!0,a.profileError=void 0,a.profileMsg=void 0,a.user.$save().then(function(e){a.profileEditForm.$setPristine(),a.profileEditForm.$setUntouched(),a.profileMsg="Profile updated."})["catch"](function(e){a.profileError=e})["finally"](function(){a.updatingProfile=!1})},a.changeEmail=function(){a.changingEmail=!0,a.emailError=void 0,a.emailMsg=void 0;var e={oldEmail:a.user.email,newEmail:a.userEdit.newEmail,password:a.userEdit.password};User.changeEmail(e).then(function(e){a.userEdit={},a.changeEmailForm.$setPristine(),a.changeEmailForm.$setUntouched(),a.emailMsg="Account email changed from to "+a.user.email+"."})["catch"](function(e){a.emailError=e})["finally"](function(){a.changingEmail=!1})},a.removeAccount=function(){var e=r.confirm().htmlContent("Your Issue Tracker account, <b>"+(a.user?a.user.email:"")+"</b>, will be deleted. This action is not reversable. Continue?").ok("Delete My Account").cancel("Cancel");r.show(e).then(function(){IssueService.disconnect(),a.removingAccount=!0,a.removeAccountError=void 0;var e={email:a.user.email,password:a.userDelete.password};User.remove(e).then(function(){a.userDelete={},console.log("account removed")})["catch"](function(e){a.removeAccountError=e})["finally"](function(){a.removingAccount=!1})})},a.changePassword=function(){a.changingPassword=!0,a.passwordChangeError=void 0,a.passwordChange.email=a.user.email,User.changePassword(a.passwordChange).then(function(){a.passwordChange={},a.changePasswordForm.$setPristine(),a.changePasswordForm.$setUntouched(),a.passwordChangeMsg="Password changed."})["catch"](function(e){a.passwordChangeError=e})["finally"](function(){a.changingPassword=!1})},a.resetPassword=function(){a.resettingPassword=!0,a.passwordResetError=void 0,a.passwordResetMsg=void 0,User.resetPassword(a.passwordResetData).then(function(){a.passwordResetForm.$setPristine(),a.passwordResetForm.$setUntouched(),a.passwordResetMsg="Password reset email sent to "+a.passwordResetData.email,a.passwordResetData={}})["catch"](function(e){a.passwordResetError=e})["finally"](function(){a.resettingPassword=!1})},a.signup=function(){a.signingUp=!0,User.create(a.signupData).then(function(e){n.go("app.home")})["catch"](function(e){a.signupError=e})["finally"](function(){a.signingUp=!1})},a.login=function(){a.loggingIn=!0,User.login(a.loginData).then(function(e){if(o.redirect){var i=JSON.parse(decodeURIComponent(o.redirect));n.go(i.name,i.params)}else n.go("app.home")})["catch"](function(e){a.loginError=e})["finally"](function(){a.loggingIn=!1})},a.logout=function(){User.logout()},a.hasSidenav=function(){return n.current.data&&n.current.data.hasSidenav},a.showSidenavToggle=function(){return $mdMedia("xs")||$mdMedia("sm")},a.toggleSidenav=function(){s("sidenav-main").toggle()},a.onSectionSelected=function(e){a.sidenav.selectedSection=e,a.firstLoad||s("sidenav-main").then(function(e){e.close()});var o=a.sidenav.sections[0].children.indexOf(e);n.go(".",{section:o>-1?o:0},{notify:!1})},a.init()}])}(angular);
//# sourceMappingURL=../sourcemaps/app.user/user.ctrl.js.map
