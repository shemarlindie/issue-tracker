!function(e){"use strict";e.module("app.user").factory("User",["AppConfig","$q",function(e,i){var n={user:void 0,users:void 0,isAdmin:void 0,isAuthenticated:function(){return FirebaseService.getRef().getAuth()},getUid:function(){return this.isAuthenticated()?this.isAuthenticated().uid:null},get:function(e){return e?this.users.$loaded(function(i){return i.$getRecord(e)}):(void 0===this.user&&this.isAuthenticated()&&(this.user=$firebaseObject(FirebaseService.getRef().child("users/"+this.isAuthenticated().uid))),this.user.$loaded())},all:function(){return this.users.$loaded()},uidToObj:function(e){for(var t=[],r=0;r<e.length;r++)t.push(n.get(e[r]));return i.all(t)},login:function(e){var n=i(function(i,n){FirebaseService.getRef().authWithPassword(e,function(e,t){e?n(e):i(t)},{remember:e.rememberMe?"default":"sessionOnly"})});return n},logout:function(){n.user&&(n.user.$destroy(),n.user=void 0),FirebaseService.getRef().unauth()},create:function(e){var t=e,r=i(function(e,i){FirebaseService.getRef().createUser(t,function(r,s){if(r)i(r);else{var o={email:t.email,password:t.password,rememberMe:!0};t.uid=s.uid,delete t.password,delete t.confirm_password,FirebaseService.getRef().child("users/"+t.uid).set(t,function(t){t?i(t):n.login(o).then(function(i){e(i)})["catch"](function(e){i(e)})})}})});return r},remove:function(e){var t=i(function(i,t){n.get().$loaded().then(function(r){var s=r.$ref();r.$destroy(),s.remove(function(r){r?t(r):FirebaseService.getRef().removeUser(e,function(e){e?t(e):(n.logout(),i(!0))})})})["catch"](function(e){t(e)})});return t},changeEmail:function(e){var t=i(function(i,t){FirebaseService.getRef().changeEmail(e,function(r){r?t(r):n.get().$loaded().then(function(n){n.email=e.newEmail,n.$save().then(function(e){i(e)})["catch"](function(e){t(e)})})["catch"](function(e){t(e)})})});return t},changePassword:function(e){var n=i(function(i,n){FirebaseService.getRef().changePassword(e,function(e){e?n(e):i(!0)})});return n},resetPassword:function(e){var n=i(function(i,n){FirebaseService.getRef().resetPassword(e,function(e){e?n(e):i(!0)})});return n}},t=function(e){e?(n.users||(n.users=$firebaseArray(FirebaseService.getRef().child("users"))),void 0===n.isAdmin&&FirebaseService.getRef().child("secrets/admin").once("value",function(e){n.isAdmin=!0,console.log("Logged in as admin.")},function(){n.isAdmin=!1,console.log("Logged in.")})):(n.user&&(console.log("destroying user profile"),n.user.$destroy(),n.user=void 0),n.users&&(console.log("destroying users array"),n.users.$destroy(),n.users=void 0),n.isAdmin=void 0,console.log("Logged out."),$state.go("login"))};return FirebaseService.onAuth(t),n}])}(angular);
//# sourceMappingURL=../sourcemaps/app.user/user.service2.js.map
